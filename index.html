<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Mocking and Stubbing in RSpec</title>

		<meta name="description" content="Presention for Ruby Lighting Talks TO">
		<meta name="author" content="Emily Fan">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/beige.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h2>Mocking and Stubbing in RSpec</h2>
					<h3>Ruby Lighting Talks T.O.</h3>
					<small>March 1, 2016</small>
					<p>
						<small>By <a href="http://emilyjfan.github.io" target="_blank">Emily Fan</a> / <a href="http://twitter.com/emilyjustinefan" target="_blank">@emilyjustinefan</a></small>
					</p>
					<aside class="notes">
						Hello everyone! Today I'll be talking to you about Mocking and Stubbing in RSpec.
						I'll go over what is it, how and when to use it, and some things to keep in mind when implementing stubs and mocks.
					</aside>
				</section>

				<section>
					<h2>Unit Testing</h2>
					<ul>
						<p>Unit testing is a software development process in which the smallest testable parts of an application, called units, are individually and independently scrutinized for proper operation.
						</p>
					</ul>

					<aside class="notes">
						Before we get into the details, I'd like to begin with a definition of what unit testing is. According to our trusty resource, Wikpedia, unit testing is a software development process in which the small testable part of an application, called units, are individually and independently scrutinized for proper opertation.

						Unit testing requires that we test pieces of our application, such as a class or a single method, and isolate it from all of its dependencies and collaborators. This forces us to focus on the very specific implementation of just that piece of functionality.
					</aside>
				</section>

				<section>
					<h2>Isolated Testing</h2>
					<blockquote cite="http://searchservervirtualization.techtarget.com/definition/Our-Favorite-Technology-Quotations">
						&ldquo;When you are writing an isolated test, you are basically hiding as much of your application as you can from that peice of code in order to be able to test it on its own.&rdquo;
					</blockquote>
					<p>- Sam Phippen, 2014</p>
					<aside class="notes">
						I have a quote here from Sam Phippen, a member of the RSpec core team, who says: in order to achieve isolated testing, you necessarily have to fake part of the world that.
					</aside>
				</section>

				<section>
					<h2>RSpec::Mocks</h2>
					<p>
						Test-double framework for RSpec with support for method stubs, fakes, and message expectations on generated test-doubles and real objects alike.
					</p>
					<aside class="notes">
					</aside>
				</section>

				<section>
					<h2>Test Doubles</h2>
					<p>
						 An object that stands in for another object in your system during a code example.
					</p>

					<pre><code class="hljs" data-trim contenteditable>

stand_in_object = double('stand-in-object')

					</code></pre>

					<aside class="notes">What's a test double? you ask. A test double is a term used for any object that stands in for a real object during a test. Often, test doubles are also refered to as mock object, test stubs, and fakes.

					We create a test double using the double method. The string argument is optional but highly recommended because it is used is failure messages

					Doubles are "strict" by default -- any message you have not allowed or expected will trigger an error -- but you can switch a double to being "loose". When creating a double, you can allow messages (and set their return values) by passing a hash.

					Once you have a test double, you can allow or expect messages on it.
					</aside>

				</section>

				<section>
					<h2>Method Stubs</h2>
					<p>
						A method stub is an implementation that returns a pre-determined value
					</p>

					<pre><code class="hljs" data-trim contenteditable>
class ReportCard
  def initialize(student)
    @student = student
  end

  def average
    grades = @student.grades
    grades.inject{ |sum, el| sum + el }.to_f / grades.size
  end
end
					</code></pre>
				</section>

				<section>
					<h2>Method Stubs</h2>
					<pre><code class="hljs" data-trim contenteditable>
describe '#average' do
  it 'calculates the student\'s average grade' do
    student = double('student')
    allow(student).to receive(:grades).and_return([80, 90, 70, 80])
    report_card = ReportCard.new(student)

    expect(report_card.average).to eq(80)
  end
end
					</code></pre>
				</section>

				<section>
					<h2>Message (Mock) Expectactions</h2>
					<p>
						An expectation that the object should receive the message
					</p>

					<pre><code class="hljs" data-trim contenteditable>
class ReportCard
  def generate(student)
    Logger.log_report_card(student) if average <= 50
  end

  .
  .
  .
end
					</code></pre>
				</section>

				<section>
					<h2>Message (Mock) Expectactions</h2>
					<pre><code class="hljs" data-trim contenteditable>
describe '#generate' do
  context 'when the student is failing' do
    it 'logs a message' do
      student = double('student', grades: [40, 40, 50, 40])
      expect(Logger).to receive(:log_report_card).with(student)
      report_card = ReportCard.new(student)

      report_card.generate(student)
    end
  end

  context 'when the student is passing' do
    it 'does not log a message' do
      student = double('student', grades: [80, 70, 80, 90])
      expect(Logger).to_not receive(:log_report_card)
      report_card = ReportCard.new(student)

      report_card.generate(student)
    end
  end
end
					</code></pre>
				</section>

				<section>
					<h2>Nomenclature</h2>
					<h3>Mocks â‰  Stubs</h3>
					<p><strong>Test Stub</strong> = a Test Double that <em>only</em> supports method stubs</p>
					<p><strong>Mock Object</strong> = a Test Double that supports message expectations <em>and</em> method stubs</p>
				</section>

				<section>
					<h2>Test Patterns: Changes in Flow</h2>
					<p>Typical test pattern: <strong>arrange-act-asert</strong></p>
					<p>Mock/Stubbing test pattern: <strong>assert-arrange-act</strong></p>
					<br>
					<p><strong>Test spies</strong> maintain the arrange-act-assert pattern</p>
				<aside class="notes">
1. Arrange all necessary preconditions and inputs.
2. Act on the object or method under test.
3. Assert that the expected results have occurred.
				</aside>

				</section>

				<section>
					<h2>Guidelines</h2>
					<ol>
						<li>Isolation from dependencies</li>
						<li>Isolation from nondeterminism</li>
						<li>Making progress without implementing dependencies</li>
						<li>Interface discovery</li>
						<li>Focus on role</li>
					</ol>
				</section>

				<section>
					<h2>Risks and Tradeoffs</h2>
					<ol>
						<li>Over specialization</li>
						<li>Nested doubles</li>
						<li>Absence of Coverage</li>
						<li>Brittle examples</li>
					</ol>
				</section>

				<section>
					<h2>Resources</h2>
					<ul>
						<li><a href="https://relishapp.com/rspec/rspec-mocks/v/3-2/docs" target="_blank">RSpec Mocks 3.2 - Documentation</a></li>
						<li><a href="https://www.youtube.com/watch?v=kiHdUU73D14" target="_blank">An Introduction to Spies in RSpec - Sam Phippen (2014)</a></li>
						<li><a href="https://www.youtube.com/watch?v=R9FOchgTtLM" target="_blank">Why You Don't Get Mock Objects - Gregory Moeck (2011)</a></li>
						<li><a href="http://www.amazon.ca/The-RSpec-Book-Behaviour-Development/dp/1934356379">The RSpec Book - David Chelimsky (2010)</a></li>
						<li><a href="http://www.jmock.org/oopsla2004.pdf" target="_blank">Mock Roles Not Objects - Steve Freeman, Nat Pryce, Tim Mackinnon, Joe Walnes (2004)</a></li>
						<li><a href="http://www.martinfowler.com/articles/mocksArentStubs.html" target="_blank">Mocks Aren't Stubs - Martin Fowler (2007)</a></li>
					</ul>

				</section>

<!-- 				<section data-markdown>
					<script type="text/template">
						## Markdown support

						Write content using inline or external Markdown.
						Instructions and more info available in the [readme](https://github.com/hakimel/reveal.js#markdown).

						```
						<section data-markdown>
						  ## Markdown support

						  Write content using inline or external Markdown.
						  Instructions and more info available in the [readme](https://github.com/hakimel/reveal.js#markdown).
						</section>
						```
					</script>
				</section>
 -->

				<section data-background="http://i.giphy.com/90F8aUepslB84.gif">
					<h2></h2>
				</section>

				<section>
					<h2></h2>
					<pre><code class="hljs" data-trim contenteditable>


					</code></pre>
				</section>

<!-- 				<section>
					<h2>Tabular Tables</h2>
					<table>
						<thead>
							<tr>
								<th>Item</th>
								<th>Value</th>
								<th>Quantity</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>Apples</td>
								<td>$1</td>
								<td>7</td>
							</tr>
							<tr>
								<td>Lemonade</td>
								<td>$2</td>
								<td>18</td>
							</tr>
							<tr>
								<td>Bread</td>
								<td>$3</td>
								<td>2</td>
							</tr>
						</tbody>
					</table>
				</section>
 -->
<!-- 				<section>
					<h2>Export to PDF</h2>
					<p>Presentations can be <a href="https://github.com/hakimel/reveal.js#pdf-export">exported to PDF</a>, here's an example:</p>
					<iframe src="https://www.slideshare.net/slideshow/embed_code/42840540" width="445" height="355" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:3px solid #666; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe>
				</section>
 -->
			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'convex', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
